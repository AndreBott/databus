#{extends '_index.html' /}
#{set title:'Dashboard' /}
#{set tab:'dashboard' /}

<script>
	var _charts_enabled = '${charts_enabled}';
	var _charts_library = '${charts_library}';
	
	%{
		showDashboard = false;
		if(dashboard_enabled.equals("true")) {
			showDashboard = true;
		}
	}%
	var _dashboard_enabled = '${showDashboard}';
	var _option_enabled = '${dashboard_chart_count}';
	
	var chart_1 = '${user_chart_1}';
	var chart_2 = '${user_chart_2}';
	var chart_3 = '${user_chart_3}';
	var chart_4 = '${user_chart_4}';
</script>

<!-- Highcarts Remote Load -->
<!-- IMPORTANT                                                                      -->
<!--    The HTTPS links work, and as far as I can tell do point to a server owned                   -->
<!--    by Highcharts, but they let their SSL certificate expire so browsers HATE                   -->
<!--    going there.                                                                    -->
<!--                                                                                -->
<!-- <script src="https://code.highcharts.com/highcharts.js" type="text/javascript"></script> -->
<!-- <script src="https://code.highcharts.com/stock/highstock.js" type="text/javascript"></script> -->
<!-- <script src="https://code.highcharts.com/stock/modules/exporting.js" type="text/javascript"></script> -->
<script type="text/javascript" src="/public/includes/highcharts/highcharts.js"></script>

<!-- Our HighCharts code -->
<script src="/public/javascripts/charts.js" type="text/javascript"></script>
<link href="/public/stylesheets/charts.css" rel="stylesheet" type="text/css">

<script type="text/javascript" src="/public/includes/highcharts/highstock.js"></script>
<script type="text/javascript" src="/public/includes/highcharts/exporting.js"></script>


        <div class="row-fluid">

        <div class="span3" style="padding-top: 20px;border-right: 1px solid #aaa !important; min-width:200px">
		<!-- Need to add a left nav bar now so we can choose between all the different charts -->
			<ul id="dashboard-menu" class="nav nav-list">            
				<li class="db_left_nav_item active"><a id="SUMMARY" class="db_left_nav_menu_item"><i class="icon-th "></i> Summary</a></li> 
				<li class="divider"></li>
				<li class="db_left_nav_item"><a id="_RSF_BUILDING_" class="db_left_nav_menu_item"><i class="icon-signal "></i> RSF_BUILDING</a></li>
				<li class="db_left_nav_item"><a id="_RSF_PV_" class="db_left_nav_menu_item"><i class="icon-signal "></i> RSF_PV</a></li>
				<li class="db_left_nav_item"><a id="_RSF_DATACENTER_" class="db_left_nav_menu_item"><i class="icon-signal "></i> RSF_DATACENTER</a></li>
				<li class="db_left_nav_item"><a id="_RSF_ELEVATOR_" class="db_left_nav_menu_item"><i class="icon-signal "></i> RSF_ELEVATOR</a></li>
				<li class="db_left_nav_item"><a id="_RSF_LIGHTING_" class="db_left_nav_menu_item"><i class="icon-signal "></i> RSF_LIGHTING</a></li>
				<li class="db_left_nav_item"><a id="_RSF_MECHANICAL_" class="db_left_nav_menu_item"><i class="icon-signal "></i> RSF_MECHANICAL</a></li>
				<li class="db_left_nav_item"><a id="_RSF_PLUG_" class="db_left_nav_menu_item"><i class="icon-signal "></i> RSF_PLUG</a></li>
				<li class="db_left_nav_item"><a id="_RSF_MISC_" class="db_left_nav_menu_item"><i class="icon-signal "></i> RSF_MISC</a></li>
				<li class="db_left_nav_item"><a id="_RSF_HEATING_" class="db_left_nav_menu_item"><i class="icon-signal "></i> RSF_HEATING</a></li>
				<li class="db_left_nav_item"><a id="_RSF_COOLING_" class="db_left_nav_menu_item"><i class="icon-signal "></i> RSF_COOLING</a></li>
				<li class="db_left_nav_item"><a id="_GARAGE_BUILDING_" class="db_left_nav_menu_item"><i class="icon-signal "></i> GARAGE_BUILDING</a></li>
				<li class="db_left_nav_item"><a id="_GARAGE_EVCS_" class="db_left_nav_menu_item"><i class="icon-signal "></i> GARAGE_EVCS</a></li>
				<li class="db_left_nav_item"><a id="_wind103W_GloCM22_" class="db_left_nav_menu_item"><i class="icon-signal "></i> wind103W_GloCM22</a></li>
				<li class="db_left_nav_item"><a id="_wind103W_DirCH1_" class="db_left_nav_menu_item"><i class="icon-signal "></i> wind103W_DirCH1</a></li>
				<li class="db_left_nav_item"><a id="_wind303W_Temp_" class="db_left_nav_menu_item"><i class="icon-signal "></i> wind303W_Temp</a></li>
				<li class="db_left_nav_item"><a id="_wind303W_WS_AT_6_" class="db_left_nav_menu_item"><i class="icon-signal "></i> wind303W_WS_AT_6</a></li>
				<li class="db_left_nav_item"><a id="_wind303W_RainSum_" class="db_left_nav_menu_item"><i class="icon-signal "></i> wind303W_RainSum</a></li>
				<li class="db_left_nav_item"><a id="_wind303W_EFM_" class="db_left_nav_menu_item"><i class="icon-signal "></i> wind303W_EFM</a></li>
			</ul>
	   </div>
	   <div id="charts_alert" class="span9 charts_alert" style="display: none;">
	   	 #{messages/charts_alert /}
	   </div>
	   <div class="span9" id="dashboard_chart_area" style="display: none;">
	  			<div id="single_chart" style="display: none;">
		    			#{dashboardCharts/singlechart /}
		    		</div>
		    		<div id="dual_chart" style="display: none;">
		    			#{dashboardCharts/dualchart /}
		    		</div>
		    		<div id="triple_chart" style="display: none;">
		    			#{dashboardCharts/threecharts /}
		    		</div>
		    		<div id="quadruple_chart" style="display: none;">
		    			#{dashboardCharts/fourcharts /}
		    		</div>
	   </div>
	   <div id="db_chart_area" class="span9" style="display: none;">
        </div>
    </div>
<script type="text/javascript">
	$('li > a').click(function() {
		$( "li" ).each(function() {
			if($(this).hasClass("db_left_nav_item")) {
				$(this).removeClass("active");
			}
		});
		
		$(this).parent().addClass('active');
	});

	$.ajaxSetup({
	    username: '${username}',
	    password: '${password}'
	  });
		
	$(document).ready(function(){
		$("#SUMMARY").click(function(){
			$('#db_chart_area').hide();
			$('#dashboard_chart_area').show();
			
			if(_dashboard_enabled === 'true') {
				if(_option_enabled === '1') {
					$('#dashboard_chart_area').show();
					$('#single_chart').show();
					$('#dual_chart').hide();
					$('#triple_chart').hide();
					$('#quadruple_chart').hide();
					
					// Now launch the chart
					if(chart_1 === 'BLANK') {					
						showBlankChart('chart_1_area');
					} else {
						addChart(chart_1, "#chart_1_area");
					}
				} else if(_option_enabled === '2') {
					$('#dashboard_chart_area').show();
					$('#single_chart').hide();
					$('#dual_chart').show();
					$('#triple_chart').hide();
					$('#quadruple_chart').hide();
					
					// Now launch the charts
					if(chart_1 === 'BLANK') {
						showBlankChart('chart_2_area');
					} else {
						addChart(chart_1, "#chart_2_area");
					}
					
					if(chart_2 === 'BLANK') {
						showBlankChart('chart_3_area');
					} else {
						addChart(chart_2, "#chart_3_area");
					}
				} else if(_option_enabled === '3') {
					$('#dashboard_chart_area').show();
					$('#single_chart').hide();
					$('#dual_chart').hide();
					$('#triple_chart').show();
					$('#quadruple_chart').hide();
				
					// Now launch the charts
					if(chart_1 === 'BLANK') {
						showBlankChart('chart_4_area');
					} else {
						addChart(chart_1, "#chart_4_area");
					}
					
					if(chart_2 === 'BLANK') {
						showBlankChart('chart_5_area');
					} else {
						addChart(chart_2, "#chart_5_area");
					}
					
					if(chart_3 === 'BLANK') {
						showBlankChart('chart_6_area');
					} else {
						addChart(chart_3, "#chart_6_area");
					}
				} else if(_option_enabled === '4') {
					$('#dashboard_chart_area').show();
					$('#single_chart').hide();
					$('#dual_chart').hide();
					$('#triple_chart').hide();
					$('#quadruple_chart').show();
					
					// Now launch the charts
					if(chart_1 === 'BLANK') {
						showBlankChart('chart_7_area');
					} else {
						addChart(chart_1, "#chart_7_area");
					}
					
					if(chart_2 === 'BLANK') {
						showBlankChart('chart_8_area');
					} else {
						addChart(chart_2, "#chart_8_area");
					}
					
					if(chart_3 === 'BLANK') {
						showBlankChart('chart_9_area');
					} else {
						addChart(chart_3, "#chart_9_area");
					}
					
					if(chart_4 === 'BLANK') {
						showBlankChart('chart_10_area');
					} else {
						addChart(chart_4, "#chart_10_area");
					}			
				}				
			}
		});
			
		$("#_RSF_BUILDING_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("RSF_BUILDING", "#db_chart_area");
		});	
			
		$("#_RSF_PV_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			$("#db_chart_area").append($('<div class="alert alert-info chart_alert">This chart is not available at this time.</div>'));
			//addChart("RSF_PV", "#db_chart_area", true);
		});		
			
		$("#_RSF_DATACENTER_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("RSF_DATACENTER", "#db_chart_area");
		});		
			
		$("#_RSF_ELEVATOR_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("RSF_ELEVATOR", "#db_chart_area");
		});		
			
		$("#_RSF_LIGHTING_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("RSF_LIGHTING", "#db_chart_area");
		});		
			
		$("#_RSF_MECHANICAL_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("RSF_MECHANICAL", "#db_chart_area");
		});		
			
		$("#_RSF_PLUG_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("RSF_PLUG", "#db_chart_area");
		});		
			
		$("#_RSF_MISC_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("RSF_MISC", "#db_chart_area");
		});		
			
		$("#_RSF_HEATING_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("RSF_HEATING", "#db_chart_area");
		});		
			
		$("#_RSF_COOLING_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("RSF_COOLING", "#db_chart_area");
		});		
			
		$("#_GARAGE_BUILDING_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("GARAGE_BUILDING", "#db_chart_area");
		});		
			
		$("#_GARAGE_EVCS_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			$("#db_chart_area").append($('<div class="alert alert-info chart_alert">This chart is not available at this time.</div>'));
			//addChart("GARAGE_EVCS", "#db_chart_area");
		});		
			
		$("#_wind103W_GloCM22_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("wind103W_GloCM22", "#db_chart_area", false, true, "Global Irradiance - Global CM22 Vent [W/m^2]");
		});		
			
		$("#_wind103W_DirCH1_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("wind103W_DirCH1", "#db_chart_area", false, true, "Avg Direct Irradiance - Direct CH1 [W/m^2]");
		});		
			
		$("#_wind303W_Temp_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("wind303W_Temp", "#db_chart_area", false, true, "Deck Dry Bulb Temp [deg C]");
		});		
			
		$("#_wind303W_WS_AT_6_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("wind303W_WS_AT_6", "#db_chart_area", false, true, "RH [%]");
		});		
			
		$("#_wind303W_RainSum_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("wind303W_RainSum", "#db_chart_area", false, true, "Precipitation [mm]");
		});		
			
		$("#_wind303W_EFM_").click(function(){
			$('#dashboard_chart_area').hide();
			$("#db_chart_area").css("background-color","#efefef");
			$("#db_chart_area").show();
			$("#db_chart_area").empty();
			addChart("wind303W_EFM", "#db_chart_area", false, true, "Precipitation [mm]");
		});	
	});
</script>

	
<script type="text/javascript">
	$(document).ready(function() {
		if(_charts_enabled === 'true') {
			if(_charts_library.indexOf('_licensed') >= 0) {
				$('#charts_alert').hide();
			} else {
				$('#charts_alert').show();
			}
		} else {
			$('#charts_alert').hide();
		}
	
		$('#SUMMARY').click();
	});
	
	function showBlankChart(divArea) {
		$(function () {
			var chartTitle = "Dashboard Chart #1";
			
			if(_option_enabled === '2') {
				if(divArea === 'chart_3_area') {
					chartTitle = "Dashboard Chart #2";
				}
			} else if(_option_enabled === '3') {
				if(divArea === 'chart_5_area') {
					chartTitle = "Dashboard Chart #2";
				} else if(divArea === 'chart_6_area') {
					chartTitle = "Dashboard Chart #3";
				}
			} else if(_option_enabled === '4') {
				if(divArea === 'chart_8_area') {
					chartTitle = "Dashboard Chart #2";
				} else if(divArea === 'chart_9_area') {
					chartTitle = "Dashboard Chart #3";
				} else if(divArea === 'chart_10_area') {
					chartTitle = "Dashboard Chart #4";
				}
			}
			
			var blankChart_alphabetLabel = ['', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'];
	
			var blankChart_xAxisLabels = {
			    categories: ['','Add', 'a', 'chart', 'to', 'your', 'dashboard', ''],
			    labels:{
			                step: 1
			            },
			    text: null
			};
			
			var blankChartSeriesData = [{
			                    showInLegend: false,
			                    data: [0,1,1,3,20,25,4,0]
			                    }];
			
			var blankChart = new Highcharts.Chart({
			    title: {
			        text: chartTitle
			    },
			    chart: {
			        renderTo: divArea
			    },
			
			    xAxis: blankChart_xAxisLabels,
			    yAxis: {
			            endOnTick: false,
			            min: 0,
			            max: 26,
			            tickInterval: 2,
			            title: { text: 'Alphabet' },
			            labels: {
			                        formatter: function() {
			                            return blankChart_alphabetLabel[this.value];
			                        }
			                    }  
			            },
			
			    series: blankChartSeriesData
			
			});
		});
	}
</script>